model saddle_orders {
  db_id         Int     @id @default(autoincrement())
  id            String? @unique

  order_name     String?
  order_id       String?
  customer_name  String?
  customer_email String?
  created_at     DateTime?
  line_item_id   String?
  product_title  String?
  product_sku    String?
  product_options String?
  quantity       Int?
  serial_numbers String?   // JSON array as string
  last_synced    DateTime?
}
// ===============================
// Prisma Client
// ===============================
generator client {
  provider = "prisma-client-js"
}

// ===============================
// Database
// ===============================
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===============================
// Shopify Session (required)
// ===============================
model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String

  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)

  refreshToken        String?
  refreshTokenExpires DateTime?
}

// ===============================
// Order
// ===============================
model Order {
  id             String   @id @default(cuid())
  shopifyOrderId String   @unique
  orderNumber    Int
  shopDomain     String

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  lineItems      LineItem[]
  serialNumbers  SerialNumber[]
}

// ===============================
// Line Item
// ===============================
model LineItem {
  id               String   @id @default(cuid())
  shopifyLineItemId String   @unique

  title            String
  sku              String?
  quantity         Int
  isSaddle         Boolean  @default(false)

  orderId          String
  order            Order    @relation(fields: [orderId], references: [id])

  serialNumbers    SerialNumber[]
}

// ===============================
// Serial Number
// ===============================
model SerialNumber {
  id              String   @id @default(cuid())

  /// Format: XX-XXXXX or XX-XXXXXX
  serial          String   @unique

  shopDomain      String
  isLocked        Boolean  @default(true)

  /// Warranty / authenticity
  warrantyActive  Boolean  @default(false)
  warrantyExpires DateTime?

  /// Relations
  orderId         String
  order           Order    @relation(fields: [orderId], references: [id])

  lineItemId      String
  lineItem        LineItem @relation(fields: [lineItemId], references: [id])

  createdAt       DateTime @default(now())
}
